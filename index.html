<!DOCTYPE HTML>
<html>
    <head>
        <title>Preventative Screening Recommender</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/main.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/map.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    </head>
    <body class="is-preload">

        <!-- Wrapper -->
            <div id="wrapper">

                <!-- Header -->
                    <header id="header">
                        <div class="logo">
                            <span class="icon fa-gem"></span>
                        </div>
                        <div class="content">
                            <div class="inner">
                                <h1>Preventative Screening Recommender</h1>
                                <p> Fill out the Health Form below for screening recommendations (note: this is not medical advice)</p>
                            </div>
                        </div>
                        <nav>
                            <ul>
                                <li><a href="#health">Health Form</a></li>
                                <li><a href="#sdohmap">SDOH Map</a></li>
                                <li><a href="#about">About</a></li>
                                <li><a href="#contact">Contact</a></li>
                            </ul>
                        </nav>
                    </header>

                <!-- Main -->
                    <div id="main">

                        <!-- Health Form -->
                            <article id="health">
                                <h2 class="major">Health Form</h2>
                                <form id="screeningForm" method="post" action="#">
                                    <div class="fields">
                                        <div class="field half">
                                            <label for="age">Age</label>
                                            <input type="text" name="age" id="age" placeholder="Enter your age"/>
                                        </div>
                            
                                        <div class="field half">
                                            <label for="gender">Gender</label>
                                            <input type="text" name="gender" id="gender" placeholder="e.g., Male, Female, Other" />
                                        </div>
                            
                                        <div class="field half">
                                            <label for="bmi">BMI</label>
                                            <input type="text" name="bmi" id="bmi" placeholder="e.g., 22.5"/>
                                        </div>

                                        <div class="field half">
                                            <label for="smoker">Smoker Status</label>
                                            <input type="text" name="smoker" id="smoker" placeholder="e.g., Yes or No" />
                                        </div>
                            
                                        <div class="field">
                                            <label for="family_history">Family History of Chronic Disease</label>
                                            <input type="text" name="family_history" id="family_history" placeholder="e.g., Diabetes, Heart Disease" />
                                        </div>
                            
                                        <div class="field half">
                                            <label for="physical_activity">Weekly Physical Activity (hrs)</label>
                                            <input type="text" name="physical_activity" id="physical_activity" placeholder="e.g., 5.5"/>
                                        </div>
                            
                                        <div class="field half">
                                            <label for="blood_pressure">Blood Pressure (mmHg)</label>
                                            <input type="text" name="blood_pressure" id="blood_pressure" placeholder="e.g., 120/80" />
                                        </div>

                                        <div class="field">
                                            <label for="cholesterol">Cholesterol Level (mg/dL)</label>
                                            <input type="text" name="cholesterol" id="cholesterol" placeholder="e.g., 190"/>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><input type="submit" value="Submit Data" class="primary" /></li>
                                        <li><input type="reset" value="Reset" /></li>
                                    </ul>
                                </form>
                                <div id="result" style="display:none; margin-top: 20px;"></div>
                            </article>

                        <!-- SDOH Map -->
                            <article id="sdohmap">
                                <h2 class="major">SDOH Vulnerability Map</h2>
                                <div id="container" style="height: 80%; width: 100%;"></div>
                            </article>

                        <!-- About -->
                            <article id="about">
                                <h2 class="major">About</h2>
                                <span class="image main"><img src="images/pic03.jpg" alt="" /></span>
                                <p>Lorem ipsum dolor sit amet, consectetur et adipiscing elit. Praesent eleifend dignissim arcu, at eleifend sapien imperdiet ac. Aliquam erat volutpat. Praesent urna nisi, fringila lorem et vehicula lacinia quam. Integer sollicitudin mauris nec lorem luctus ultrices. Aliquam libero et malesuada fames ac ante ipsum primis in faucibus. Cras viverra ligula sit amet ex mollis mattis lorem ipsum dolor sit amet.</p>
                            </article>

                        <!-- Contact -->
                            <article id="contact">
                                <h2 class="major">Contact</h2>
                                <form method="post" action="#">
                                    <div class="fields">
                                        <div class="field half">
                                            <label for="name">Name</label>
                                            <input type="text" name="name" id="name" />
                                        </div>
                                        <div class="field half">
                                            <label for="email">Email</label>
                                            <input type="text" name="email" id="email" />
                                        </div>
                                        <div class="field">
                                            <label for="message">Message</label>
                                            <textarea name="message" id="message" rows="4"></textarea>
                                        </div>
                                    </div>
                                    <ul class="actions">
                                        <li><input type="submit" value="Send Message" class="primary" /></li>
                                        <li><input type="reset" value="Reset" /></li>
                                    </ul>
                                </form>
                                <ul class="icons">
                                    <li><a href="#" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
                                </ul>
                            </article>

                    </div>

                <!-- Footer -->
                    <footer id="footer">
                        <p class="copyright">Github: Vishie-Hub Design: <a href="https://html5up.net/license">HTML5 UP</a>.</p>
                    </footer>

            </div>

        <!-- BG -->
            <div id="bg"></div>

        <!-- Scripts -->
            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/browser.min.js"></script>
            <script src="assets/js/breakpoints.min.js"></script>
            <script src="assets/js/util.js"></script>
            <script src="assets/js/main.js"></script>

        <!-- SDOH Map Script -->
            <script>
            (async () => {
                console.log("Fetching map data...");
                const mapData = await fetch(
                    'https://code.highcharts.com/mapdata/countries/us/us-all-all.topo.json'
                ).then(response => response.json());

                console.log("Fetching SDOH vulnerability data...");
                const data = await fetch('County_SDOH_Vulnerability_Scores.csv') // Updated to reference CSV in the same folder
                    .then(response => response.text())
                    .then(csv => {
                        const parsedData = Papa.parse(csv, { header: true });
                        console.log("Parsed Data:", parsedData.data);
                        return parsedData.data.map(item => ({
                            'hc-key': item['CountyFIPS'], // Ensure correct matching with the county codes
                            'value': parseFloat(item['Overall SDOH Vulnerability Score']) // Replace with your actual column name
                        }));
                    });

                console.log("Data for counties:", data);

                // Add state acronym for tooltip
                mapData.objects.default.geometries.forEach(g => {
                    const properties = g.properties;
                    if (properties['hc-key']) {
                        properties.name = properties.name + ', ' +
                            properties['hc-key'].substr(3, 2).toUpperCase();
                    }
                });

                document.getElementById('container').innerHTML = 'Rendering map...';

                setTimeout(function () {
                    Highcharts.mapChart('container', {
                        chart: {
                            map: mapData,
                            height: '80%'
                        },

                        title: {
                            text: 'SDOH Vulnerability Scores Across US Counties',
                            align: 'left'
                        },

                        accessibility: {
                            description: 'Map showing SDOH vulnerability scores by county.'
                        },

                        legend: {
                            layout: 'vertical',
                            align: 'right',
                            margin: 0,
                            backgroundColor: 'rgba(255, 255, 255, 0.85)'
                        },

                        mapNavigation: {
                            enabled: true
                        },

                        colorAxis: {
                            min: 0,
                            max: 1,
                            tickInterval: 0.1,
                            stops: [
                                [0, '#F1EEF6'],
                                [0.5, '#900037'],
                                [1, '#500007']
                            ],
                            labels: {
                                format: '{value}'
                            }
                        },

                        plotOptions: {
                            mapline: {
                                showInLegend: false,
                                enableMouseTracking: false
                            }
                        },

                        series: [{
                            data: data,
                            joinBy: ['hc-key', 'code'],
                            name: 'SDOH Vulnerability Score',
                            tooltip: {
                                valueSuffix: ''
                            },
                            borderWidth: 0.5,
                            shadow: false,
                            accessibility: {
                                enabled: false
                            }
                        }, {
                            type: 'mapline',
                            name: 'State borders',
                            color: 'white',
                            shadow: false,
                            borderWidth: 2,
                            accessibility: {
                                enabled: false
                            }
                        }]
                    });
                }, 0);
            })();
            </script>

    </body>
</html>
